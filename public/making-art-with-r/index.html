	<!doctype html>
<html lang="en">
  <head>
    <title>Making Art with R  - Random Strolls | Dario Mavec</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

    
    <link href="/css/milk.min.css" rel="stylesheet">
    <link href="/css/milk-responsive.min.css" rel="stylesheet">     
    <link href="/css/style.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/fonts.css" rel="stylesheet" type="text/css" media="all">
    
    <link href="https://vjs.zencdn.net/7.8.4/video-js.css" rel="stylesheet" />
    <link href="https://unpkg.com/@videojs/themes@1/dist/forest/index.css" rel="stylesheet" />

    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="">
    <link rel="canonical" href="/making-art-with-r/">

    
    <link href="/rss.xml" type="application/atom+xml" rel="alternate" title="Random Strolls">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/an-old-hope.min.css">
    

  </head>
  <body>
    <div class="navbar navbar-fixed-top">
  <div id="navbar-inner">
    <div id="logo">
     <a href="/"><img src="/img/header.png" title="Sandals by Claudia Lo Giudice from the Noun Project" width="100px"></img></a>
  </div>
      <div class="menu-header content">
        <a href="/">
          <h1>Random Strolls</h1>
        </a>
      </div>
    </div>
</div>



<div class="container">
  <div class="content">
    <div class="row-fluid">
      <div class="span12">
        <div class="posts">


	    
	  <div class="post">
	    <header class="post-header">
	        <h1><a href="/making-art-with-r/">Making Art with R</a></h1>
	        <div class="post-time">September 14 2020</div>
	    </header>
	    <div class="post-after">
	        <div class="tags">
	            
	                <a href="//tags/r">R</a>
	            
	                <a href="//tags/tidy-tuesday">Tidy Tuesday</a>
	            
	        </div>
	    </div>
	    <hr>
	    <div class="post content">
	        


<div id="canvas-cards" class="section level1">
<h1>Canvas Cards</h1>
<p>As a side project this year, I thought it would be fun to play around with
making art in R. Because I’m not all that original, I will use an existing
developer’s project as the guide for my development. In particular,
<a href="https://canvas-cards.glitch.me/">Canvas Cards</a> will be the basis of inspiration
for each card.</p>
<p>To stop this from being a pure copy paste exercise, I want to establish some
constraints for this project:</p>
<ul>
<li>Only use packages for general data handling and plotting purposes
(e.g. <code>tidyverse</code>, <code>ggforce</code>). General polygon creation / transformations will
be “hand-crafted”.</li>
<li>52 cards to be generated by the end of 2020 - aim for ~3 per week. Each card
will be posted on the blog with a short discussion.</li>
<li>All code to be stored on open repo on GitHub.</li>
<li>End result package should be reasonably tidy with decent documentation.</li>
<li>The aim isn’t to replicate each card exactly, and to allow creativity to lead
in different directions.</li>
</ul>
<p>So, let’s give it a whirl!</p>
</div>
<div id="getting-started" class="section level1">
<h1>Getting Started</h1>
<p>So to begin with, we’re going to develop all the cards as part of an R package.
This development pattern makes it much easier to maintain our code, and
understand what dependencies we’re relying on. To start with we’ll take a quick
and dirty approach to generate our first results. As we develop more cards,
we’ll think about how we can leverage common patterns to simplify the codebase.</p>
<p>RStudio makes the setup of a new package project super straightforward through
the wizard. In addition, we want to have this linked to <a href="https://github.com/dariomavec/canvasr">GitHub</a> for easy sharing
of the code.</p>
</div>
<div id="helpers" class="section level1">
<h1>Helpers</h1>
<p>We will be using <code>ggplot2</code> to generate our canvases, however there are a few
helpers we will want to structure the format of our outputs. Also, I really like
the idea of seeing the steps taken to reach each card, based on
<a href="https://twitter.com/geokaramanis/status/1304399516012023810">Georgios Karamanis</a>
Tidy Tuesday submissions. So we’ll output an image every time we run the code,
and use <code>magick</code> to stitch the images into a video GIF.</p>
<pre class="r"><code>#&#39; Save Plot
#&#39;
#&#39; @param plot
#&#39; @param file_name
#&#39; @param width
#&#39; @param height
#&#39; @param path
#&#39;
#&#39; @return
#&#39; @export
#&#39; @import ggplot2
save_plot &lt;- function(
  plot,
  file_name,
  width,
  height,
  path = &#39;output&#39;,
  echo = TRUE,
  ...) {
  dir.create(glue(&quot;{path}/{file_name}/&quot;), showWarnings = FALSE)
  temp_path &lt;- glue(&quot;{path}/{file_name}/{format(Sys.time(), &#39;%y-%m-%d-%H-%M-%S&#39;)}.png&quot;)
  output_path &lt;- glue(&quot;{path}/{file_name}.png&quot;)

  # fig &lt;- image_graph(width = width,
  #                    height = height,
  #                    res = 96)
  if (echo) print(plot)

  ggplot2::ggsave(plot,
                  filename = output_path,
                  width = width / 100,
                  height = height / 100,
                  device = &#39;png&#39;)

  fig &lt;- output_path %&gt;%
    image_read() %&gt;%
    image_trim()

  image_write(fig, output_path)
  image_write(fig, temp_path)
}

#&#39; @import magick
save_gif &lt;- function(
  file_name,
  path = &#39;output&#39;) {
  files &lt;- list.files(path=glue(&quot;{path}/{file_name}/&quot;), pattern = &#39;*.png&#39;, full.names = TRUE)
  files &lt;- c(rep(last(files), 12), files)

  files %&gt;%
    image_read() %&gt;% # reads each path file
    image_join() %&gt;% # joins image
    image_animate(fps=5) %&gt;% # animates, can opt for number of loops
    image_write(glue(&quot;{path}/{file_name}.gif&quot;))
}</code></pre>
<p>Straight out of the gate there are a few basic geometric transformations which
will be useful. In particular we have a polygon rotation function, and a simple
way to generate a square using a centre point and height.</p>
<p>It was fun brushing up on my linear algebra to generate the rotation matrix! We
will revisit these helpers later to improve them.</p>
<pre class="r"><code>rotate_poly &lt;- function(poly, origin, theta = -pi / 10) {
  R &lt;- matrix(c(cos(theta), -sin(theta),
                sin(theta), cos(theta)),
              nrow = 2)

  map(poly, function(xy) {
    rotated &lt;- R %*% (xy - origin)
    rotated[1:2, 1] + origin
  })
}

square_from_centre &lt;- function(origin, height, rotate = FALSE, theta = -pi / 10) {
  xmin = origin[1] - height / 2
  xmax = origin[1] + height / 2
  ymin = origin[2] - height / 2
  ymax = origin[2] + height / 2

  square &lt;- list(
    c(xmin, ymin),
    c(xmin, ymax),
    c(xmax, ymax),
    c(xmax, ymin),
    c(xmin, ymin)
  )

  if (rotate) square &lt;- rotate_poly(square, origin, theta)

  return(square)
}</code></pre>
<p>And with that we’re away!</p>
</div>

	    </div>
	    
		<nav id="pagination">
			<a class="prev" href="/r-art-varsarely/">Prev</a>
			<a class="next" href="/r-logger-and-working-smarter/">Next</a>
		</nav>
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "randomstrolls" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	
		        <footer class='post-footer'>
		        	Built with <a href="https://github.com/spf13/hugo">Hugo</a> | Theme <a href="https://github.com/AlexFinn/simple-a">Simple A</a> (<a href="https://github.com/AlexFinn">AlexFinn</a>)
		          <p>© <a href="https://mavec.me/">Dario Mavec</a> 2020</p>
		        </footer>
		    </div>
		  </div>
		</div>
      </div>
    </div>
    
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-173464547-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/highlight.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/r.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  <script src="https://vjs.zencdn.net/7.8.4/video.js"></script>

</body>
</html>

